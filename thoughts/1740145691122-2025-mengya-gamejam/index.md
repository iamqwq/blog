---
title: "2025 萌芽游戏极限开发"
date: 2025-02-21
draft: false
description: ""
tags: ["review"]
---
## 最前

在 GGJ 结束的几天后，应策划盛情邀请，决定趁热打铁，参加 Mengya Gamejam，萌芽是浙大和..，新近出现的 Gamejam 活动，对新手 Jammer 来说非常友好，组队的朋友也多是新手 Jammer，开发时长为 16 天，较为宽裕，总观氛围轻松。

48h 的紧张刺激虽不失一种体验，但真临了赛前，还是这种宽松的赛制让人感到亲切。

这次比赛同样是担任程序。

策划的人手召集能力令人震撼，在短短几天就组建了一支六人满编的队伍。分工上一个策划、两个程序、三个美术，三位美术老师之间有一位是偏向制作 2D 资产，两位是偏向制作 3D 资产。

见队里有两位 3D 美术，加上我本身希望实战一下 3D 开发，因此沟通后在赛前就决定制作 3D 游戏。

## 开发过程

### §1. 主题和 Gameplay 设计

主题是 Step，含义非常多，发散空间很大。

头脑风暴后，我们得到了五个扣题方式下的八个 Gameplay。经策划敲定，我们决定以“脚步”作为扣题元素。

头脑风暴的方法将会另起一篇文章来梳理。

我们的 Gameplay 是一个类 FNAF（玩具熊的五夜后宫）的设计。玩家扮演一名在一家有怪物游荡医院就职的安保人员，在监控室中观察各个房间，通过操作面板干扰怪物抵达监控室，在一定时间内没有怪物抵达监控室则玩家胜利，反之或 San 值降到最低则玩家失败。

初期构想有四个 NPC，不同 NPC 有不同的出动条件和行为逻辑。预期的玩家行为是玩家根据 NPC 在移动时发出的脚步声对其位置进行初步猜测，然后小心地切换监控确认 NPC 位置（如果监控观察时与 NPC 距离太近则会进行跳脸和 San 值惩罚），玩家激活灯光和防火警报吸引 NPC 前往远离监控室的房间（有些 NPC 免疫某些吸引方式），同时开始判断其它 NPC 的位置，吸引到远离监控室的房间，如此反复，直到规定时间结束。

### §2. 实现

这部分比较繁多，在叙述开发经手的所有工作后，简单记录其中的难点。

#### §2. 0. 工作概览

在实际开发中，除了程序外我同时兼做了场景编排、音频处理、UI 绘制等工作，不过相比程序来说，这些我没有涉足太深的领域的收获比较零散，概览以程序为主。

1. 视角管理，参考 FNAF，其中玩家可以在控制面板和监控室两个视角间切换。
2. 物体管理，物体管理实际是对很多相同类似的需求进行合并和抽象，包括机位、灯光、防火铃以及 NPC 的管理等。
3. NPC 行为，构造一个智能的 NPC 行为。
4. 即时演出，当发生跳脸后，我们希望场景中的灯光能够配合进行诡异的闪烁，并阻断玩家操作，强制使玩家离开监控画面等，诸如此类需要其它模块配合的演出。
5. UI 交互，玩家可以通过控制面板 UI 触发预定义的视角、灯光和音频行为。
6. 画面处理，通过 Shader 和后处理的方式增强沉浸感。

很遗憾的是，由于最终缺少时间和资产，最终 NPC 的数量由四个减少到了一个。

#### §2. 1. 物体交互

场景内的物体相互之间交互的需求很多，灯光、防火铃、门与 NPC、与玩家间都多有交互，transform 字符串路径式的查找成了后续维护困难的选择，如何妥当的处理交互成为了一个问题。

处理交互分为两步：第一找到需要交互的目标物体对象，第二对目标物体对象进行操作。后者并不复杂，暂按不作功夫。为简化前者，我选择了对物体检索封装成为一个管理类，用提前设计好的枚举作为标识符直接获取对应物体对象。

灯光和防火铃的激活需要 NPC 来响应，这种类型的交互问题则通过封装一个事件系统来处理。

#### §2. 2. NPC 行为

NPC 的状态机中处理了待机、寻路、跳脸三种行为，难点主要是寻路逻辑。

NPC 拥有一条基本路线，初始按基本路线的房间顺序为目的地依次移动；当被干扰偏离路线并抵达干扰路线的终点时，会回到此时与基本路线最近的房间，路线由图寻路算法计算（寻路算法上由组内另一位程序老师实现，思路是预先将房间连通情况和 NPC 路线外置为 json，加载时构造为图结构，最终以 Dijkstra 计算结果），实际移动路径由 NavMesh 计算。

#### §2. 3. 画面表现

玩家在场景内看到电脑屏幕中显示的监控画面是一组通过 Camera Stacking 堆叠了 Main Camera、UI 和 Post Processing 三个渲染结果呈现的 RenderTexture。

在后处理方面，我选择自定义 RenderFeature 使画面压缩到低像素完成像素化，然后进行色调调整，同时根据 San 值调整 Chromatic Aberration（或许中文应该翻译为色差）营造感觉。

## 事后回顾

### §1. 游戏性

游戏的定位是恐怖策略游戏，本质上玩家是在合理的调度房间可用于干扰 NPC 路线的资源，尽最大可能性将 NPC 调到远离监控室的位置。

为丰富策略性，策划还设计了发电机，其中一个 NPC 会破坏发电机进以一段时间玩家对监控的控制。

但由于策划案中四个 NPC 计划的破产，策略这一元素就很难体现出来了，玩家对一个 NPC 可以单方面不断的拉扯。

但如果不考虑完成度，Gameplay 的设计是相当好的。

### §2. 技术细节

#### §2. 1. 项目架构

有很多各种场景都可以复用的需求，实现的思路或方案并不好，比如资源管理、音频管理、游戏全局的状态机（即 GameFramework 中的 Procedure）。

项目逻辑相比练习的项目体量大了很多，意识到会一个在各种场景下都具复用性的框架和规范的重要性，框架中对于遇到的相同问题可能会有比较成熟的解决方案。对于 GameFramework 的学习在此次 Gamejam 后决计要提上日程了。

#### §2. 2. NPC 行为

NPC 的行为逻辑还有很大优化空间。

首先不可不提及的是最重要的 NPC 的寻路逻辑，寻路的逻辑简而言之是基本路线 + 偏离后返回基本路线最近的节点的组合，然而这种策略会产生一些意外情况：

1. NPC 偏离到一些较远房间后，返回的路线既长又属于基本路线的前几个节点。进一步说，这样首先会导致玩家过于容易拉扯 NPC，其次又会导致 NPC 会重走一遍基本路线。
2. 如果灯光或防火铃使 NPC 偏离到距基本路线最后一个节点很近的房间，那么在 NPC 返回到基本路线上后，就可以迅速抵达终点，换言之，玩家的监控室。这意味着对于玩家来说，地图上距离监控室太近的房间的灯光和防火铃都是完全无益的选项。

或许基本路线 + 偏离后返回基本路线最近的节点的方案，是不合适的。

在事后思考，我又重新构思了一个寻路逻辑。NPC 对所有与目前所在位置相邻的房间计算权重：

1. 若进入该房间，该房间节点距离与玩家节点的距离，距离越小权值越高。
2. 该房间连通的未前往过的房间的数量，数量越大权值越高。

然后将权重与一个调整系数相乘，两个权重相加，进行带权随机判定，NPC 会进入判定成功的房间。

这个思路有待实验，将会另起一篇文章来尝试。

## 最后

这次 Gamejam 的完成度相较 GGJ 高了很多，而且和朋友分享反馈不错，对 3D 的初次尝试，让人心生欣喜。

感谢我的所有队友，感谢大家的工作付出，我们合作中非常融洽，此外交流很多，相谈甚欢，是不可多得的记忆！